"use strict";(self.webpackChunkdev_site_documentation_template=self.webpackChunkdev_site_documentation_template||[]).push([[4040],{5521:function(e,n,t){t.r(n),t.d(n,{_frontmatter:function(){return l},default:function(){return u}});var a,i=t(87462),o=t(63366),s=(t(15007),t(64983)),r=t(91515),d=["components"],l={},p=(a="InlineAlert",function(e){return console.warn("Component "+a+" was not imported, exported, or provided by MDXProvider as global scope"),(0,s.mdx)("div",e)}),c={_frontmatter:l},m=r.Z;function u(e){var n=e.components,t=(0,o.Z)(e,d);return(0,s.mdx)(m,(0,i.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,s.mdx)("h1",{id:"manual-display-and-tracking-of-push-notification"},"Manual display and tracking of push notification"),(0,s.mdx)("p",null,"This document describes how to manually build, display and track push notifications from Adobe Journey Optimizer using the AEPMessaging extension. You should use the ",(0,s.mdx)("a",{parentName:"p",href:"./automatic-handling-and-tracking.md"},"automatic display and tracking")," method unless you have a specific requirement to manually build, display, and track push notifications."),(0,s.mdx)("h2",{id:"pre-requisites"},"Pre-requisites"),(0,s.mdx)("p",null,(0,s.mdx)("a",{parentName:"p",href:"../../../index.md#implement-extension-in-mobile-app"},"Integrate and register the Messaging extension")," in your app."),(0,s.mdx)("h2",{id:"sync-the-push-token"},"Sync the push token"),(0,s.mdx)("p",null,"To retrieve the push token from Firebase Messaging Service, please follow the tutorial within the ",(0,s.mdx)("a",{parentName:"p",href:"https://firebase.google.com/docs/cloud-messaging/android/client#retrieve-the-current-registration-token"},"Firebase documentation"),". Then use ",(0,s.mdx)("inlineCode",{parentName:"p"},"setPushIdentifier")," API to sync the device's push token with profile in Adobe Experience Platform."),(0,s.mdx)(p,{variant:"info",slots:"text",mdxType:"InlineAlert"}),(0,s.mdx)("p",null,"Although this API is provided in Mobile Core, the use of this API is required and leveraged by the Adobe Journey Optimizer extension to sync provided push tokens with Adobe Experience Platform services."),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-java"},"public class YourApp extends Application {\n\n    @Override\n    public void onCreate() {\n        super.onCreate();\n        FirebaseMessaging.getInstance().getToken().addOnCompleteListener(new OnCompleteListener<String>() {\n\n            @Override\n            public void onComplete(@NonNull Task<String> task) {\n                if (task.isSuccessful()) {\n                    String token = task.getResult();\n                    MobileCore.setPushIdentifier(token);\n                }       \n            }\n        });\n    }\n}\n")),(0,s.mdx)("h2",{id:"building-and-displaying-notification"},"Building and displaying notification"),(0,s.mdx)("ol",null,(0,s.mdx)("li",{parentName:"ol"},(0,s.mdx)("p",{parentName:"li"},"In ",(0,s.mdx)("inlineCode",{parentName:"p"},"onMessageReceived")," method of ",(0,s.mdx)("inlineCode",{parentName:"p"},"YourAppFirebaseMessagingService")," class, create a ",(0,s.mdx)("inlineCode",{parentName:"p"},"MessagingPushPayload")," object from the remoteMessage. ",(0,s.mdx)("inlineCode",{parentName:"p"},"MessagingPushPayload")," will unpack the remoteMessage and provide APIs for getting attributes used for creating the push notification."),(0,s.mdx)("pre",{parentName:"li"},(0,s.mdx)("code",{parentName:"pre",className:"language-java"},"MessagingPushPayload payload = new MessagingPushPayload(remoteMessage);\n"))),(0,s.mdx)("li",{parentName:"ol"},(0,s.mdx)("p",{parentName:"li"},"Use the ",(0,s.mdx)("a",{parentName:"p",href:"../enum-public-classes/messaging-push-payload.md"},"Public APIs")," of MessagingPushPayload to get the attributes required for creating the push notification."),(0,s.mdx)("pre",{parentName:"li"},(0,s.mdx)("code",{parentName:"pre",className:"language-java"},"// Following are a few examples of using the public APIs of MessagingPushPayload\nString title = payload.getTitle();\nString body = payload.getBody();\nint badgeCount = payload.getBadgeCount();\nint notificationPriority = payload.getNotificationPriority();\nString channelId = payload.getChannelId();\nString icon = payload.getIcon();\nString imageUrl = payload.getImageUrl();\n"))),(0,s.mdx)("li",{parentName:"ol"},(0,s.mdx)("p",{parentName:"li"},"The intent which is created while building the notification needs to be updated with necessary Adobe information to track push notification interactions."),(0,s.mdx)("pre",{parentName:"li"},(0,s.mdx)("code",{parentName:"pre",className:"language-java"},"Messaging.addPushTrackingDetails(\n    final Intent intent, // intent which will be used when user interacts with the notification.\n    final String messageId, // message.id which represents the id of the push notification\n    final Map<String, String> data) // message.data which represents the data part of the remoteMessage.\n"))),(0,s.mdx)("li",{parentName:"ol"},(0,s.mdx)("p",{parentName:"li"},"Use NotificationManager to create and display the built notification."))),(0,s.mdx)("p",null,"Here is a sample code for creating a notification channel and building the notification."),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-java"},"public class YourAppFirebaseMessagingService extends FirebaseMessagingService {\n\n    @Override\n    public void onMessageReceived(@NonNull RemoteMessage remoteMessage) {\n        super.onMessageReceived(remoteMessage);\n        // Create a MessagingPushPayload object from the remoteMessage\n        MessagingPushPayload payload = new MessagingPushPayload(remoteMessage);\n\n        // Write your code for creating or using an existing notification channel.\n\n        // Creating an intent and attaching tracking details to it.\n        Intent intent = new Intent(this, MainActivity.class);\n        Messaging.addPushTrackingDetails(intent, remoteMessage.getMessageId(), remoteMessage.getData());\n        \n        // Write your code to create a pending intent\n        \n        // Create a notification builder \n        NotificationCompat.Builder notificationBuilder = new NotificationCompat.Builder(this, CHANNEL_ID)\n                        .setSmallIcon(R.drawable.ic_launcher_foreground)\n                        .setContentTitle(payload.getTitle())\n                        .setContentText(payload.getBody())\n                        .setAutoCancel(true)\n                        .setContentIntent(pendingIntent);\n\n        // Write your code to add custom buttons to notification, if neccessary.\n\n        // Write your code to download and attach media to notification, if neccessary.\n\n        notificationManager.notify(notificationId, notificationBuilder.build());\n    }\n}\n")),(0,s.mdx)("h2",{id:"tracking-push-notification-interactions"},"Tracking push notification interactions"),(0,s.mdx)("p",null,"After the application is opened by the user by clicking on the push notification, use the ",(0,s.mdx)("inlineCode",{parentName:"p"},"handleNotificationResponse")," API to send the push notification interactions feedback to Platform."),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-java"},"    Messaging.handleNotificationResponse(\n        final Intent intent, // Intent which contains information related to messageId and data\n        final boolean applicationOpened, //  whether application was opened or not\n        final String actionId) // actionId of the element which performed the custom action.\n")),(0,s.mdx)("p",null,(0,s.mdx)("strong",{parentName:"p"},"Sending push notification interaction feedback when application is opened without any custom action")),(0,s.mdx)("p",null,"Add the following code where you have access to ",(0,s.mdx)("inlineCode",{parentName:"p"},"intent")," after the user has interacted with the push notification:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-java"},"Messaging.handleNotificationResponse(intent, true, null);\n")),(0,s.mdx)("p",null,(0,s.mdx)("strong",{parentName:"p"},"Sending feedback when application is opened with a custom action")),(0,s.mdx)("p",null,"Similar to the example above, call the ",(0,s.mdx)("inlineCode",{parentName:"p"},"handleNotificationResponse")," API but this time with a custom action:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-java"},"Messaging.handleNotificationResponse(intent, true, <actionId>);\n")),(0,s.mdx)("p",null,(0,s.mdx)("strong",{parentName:"p"},"Sending feedback when application is not opened but a custom action is performed by the user")),(0,s.mdx)("p",null,"Add the following code where you have access to ",(0,s.mdx)("inlineCode",{parentName:"p"},"intent")," after the user has interacted with the push notification:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-java"},"Messaging.handleNotificationResponse(intent, false, <actionId>);\n")),(0,s.mdx)("p",null,"Here is a sample code for sending push notification interactions feedback to Platform."),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-java"},"\npublic class MainActivity extends AppCompatActivity {\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n\n        final Intent intent = getIntent();\n\n        // use your unique way to determine isAppOpenFromPushInteraction\n        if (isAppOpenFromPushInteraction) {\n            // tracking application opened with no custom action\n            Messaging.handleNotificationResponse(intent, true, null);\n        }\n    }\n}\n")))}u.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-edge-adobe-journey-optimizer-push-notification-android-manual-display-and-tracking-md-2aac72a0b7d45cf1d04b.js.map