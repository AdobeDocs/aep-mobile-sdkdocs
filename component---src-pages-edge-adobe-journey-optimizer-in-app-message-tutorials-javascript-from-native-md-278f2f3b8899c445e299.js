"use strict";(self.webpackChunkdev_site_documentation_template=self.webpackChunkdev_site_documentation_template||[]).push([[9746,1607],{76177:function(e,n,a){a.r(n),a.d(n,{_frontmatter:function(){return p},default:function(){return c}});var t,r=a(87462),s=a(63366),l=(a(15007),a(64983)),i=a(91515),d=a(88851),o=["components"],p={},m=(t="TabsBlock",function(e){return console.warn("Component "+t+" was not imported, exported, or provided by MDXProvider as global scope"),(0,l.mdx)("div",e)}),u={_frontmatter:p},g=i.Z;function c(e){var n=e.components,a=(0,s.Z)(e,o);return(0,l.mdx)(g,(0,r.Z)({},u,a,{components:n,mdxType:"MDXLayout"}),(0,l.mdx)("h1",{id:"execute-javascript-methods-from-native-code"},"Execute JavaScript methods from native code"),(0,l.mdx)("p",null,"You can execute JavaScript in an in-app message from native code by completing the following steps:"),(0,l.mdx)("ul",null,(0,l.mdx)("li",{parentName:"ul"},(0,l.mdx)("a",{parentName:"li",href:"#implement-and-assign-a-presentationdelegate-messagingdelegate"},"Implement and assign a ",(0,l.mdx)("inlineCode",{parentName:"a"},"PresentationDelegate"),"/ ",(0,l.mdx)("inlineCode",{parentName:"a"},"MessagingDelegate"))),(0,l.mdx)("li",{parentName:"ul"},(0,l.mdx)("a",{parentName:"li",href:"#obtain-a-reference-to-the-inappmessageeventhandler-web-view"},"Obtain a reference to the web view")),(0,l.mdx)("li",{parentName:"ul"},(0,l.mdx)("a",{parentName:"li",href:"#call-the-javascript-method"},"Call the JavaScript method"))),(0,l.mdx)("h2",{id:"implement-and-assign-a-presentationdelegate-messagingdelegate"},"Implement and assign a ",(0,l.mdx)("inlineCode",{parentName:"h2"},"PresentationDelegate"),"/ ",(0,l.mdx)("inlineCode",{parentName:"h2"},"MessagingDelegate")),(0,l.mdx)("p",null,"To register a JavaScript event handler with a ",(0,l.mdx)("inlineCode",{parentName:"p"},"Message")," object, you will first need to implement and set a ",(0,l.mdx)("inlineCode",{parentName:"p"},"PresentationDelegate")," or ",(0,l.mdx)("inlineCode",{parentName:"p"},"MessagingDelegate")," (for older Android SDK versions and iOS SDK) you are using."),(0,l.mdx)("p",null,"Please read the ",(0,l.mdx)("a",{parentName:"p",href:"./messaging-delegate.md"},"tutorial")," for more detailed instructions on implementing and using a PresentationDelegate/ MessagingDelegate (for older Android SDK versions and iOS SDK)."),(0,l.mdx)("h2",{id:"obtain-a-reference-to-the-inappmessageeventhandler-web-view"},"Obtain a reference to the ",(0,l.mdx)("inlineCode",{parentName:"h2"},"InAppMessageEventHandler"),"/ web view"),(0,l.mdx)("p",null,"In the ",(0,l.mdx)("inlineCode",{parentName:"p"},"shouldShowMessage")," function of the ",(0,l.mdx)("inlineCode",{parentName:"p"},"MessagingDelegate"),", get a reference to the web view used by the message."),(0,l.mdx)(m,{orientation:"horizontal",slots:"heading, content",repeat:"3",mdxType:"TabsBlock"}),(0,l.mdx)("p",null,"Android 3.x"),(0,l.mdx)(d.default,{query:"platform=android3x&task=obtain",mdxType:"Tabs"}),(0,l.mdx)("p",null,"Android 2.x (Older version)"),(0,l.mdx)(d.default,{query:"platform=android2x&task=obtain",mdxType:"Tabs"}),(0,l.mdx)("p",null,"iOS"),(0,l.mdx)(d.default,{query:"platform=ios&task=obtain",mdxType:"Tabs"}),(0,l.mdx)("h2",{id:"call-the-javascript-method"},"Call the JavaScript method"),(0,l.mdx)(m,{orientation:"horizontal",slots:"heading, content",repeat:"3",mdxType:"TabsBlock"}),(0,l.mdx)("p",null,"Android 3.x"),(0,l.mdx)(d.default,{query:"platform=android3x&task=call",mdxType:"Tabs"}),(0,l.mdx)("p",null,"Android 2.x (Older version)"),(0,l.mdx)(d.default,{query:"platform=android2x&task=call",mdxType:"Tabs"}),(0,l.mdx)("p",null,"iOS"),(0,l.mdx)(d.default,{query:"platform=ios&task=call",mdxType:"Tabs"}),(0,l.mdx)("h2",{id:"examples"},"Examples"),(0,l.mdx)("p",null,"The test apps in this repository demonstrate executing JavaScript code from an in-app message's webview:"),(0,l.mdx)("ul",null,(0,l.mdx)("li",{parentName:"ul"},(0,l.mdx)("a",{parentName:"li",href:"https://github.com/adobe/aepsdk-messaging-ios/tree/main/TestApps/MessagingDemoApp"},"Swift")),(0,l.mdx)("li",{parentName:"ul"},(0,l.mdx)("a",{parentName:"li",href:"https://github.com/adobe/aepsdk-messaging-ios/tree/main/TestApps/MessagingDemoAppObjC"},"Objective-C")),(0,l.mdx)("li",{parentName:"ul"},(0,l.mdx)("a",{parentName:"li",href:"https://github.com/adobe/aepsdk-messaging-android/tree/main/code/testapp"},"Kotlin"))))}c.isMDXComponent=!0},88851:function(e,n,a){a.r(n),a.d(n,{_frontmatter:function(){return o},default:function(){return g}});var t,r=a(87462),s=a(63366),l=(a(15007),a(64983)),i=a(91515),d=["components"],o={},p=(t="Variant",function(e){return console.warn("Component "+t+" was not imported, exported, or provided by MDXProvider as global scope"),(0,l.mdx)("div",e)}),m={_frontmatter:o},u=i.Z;function g(e){var n=e.components,a=(0,s.Z)(e,d);return(0,l.mdx)(u,(0,r.Z)({},m,a,{components:n,mdxType:"MDXLayout"}),(0,l.mdx)(p,{platform:"android3x",task:"obtain",repeat:"5",mdxType:"Variant"}),(0,l.mdx)("p",null,"In the ",(0,l.mdx)("inlineCode",{parentName:"p"},"onShow")," function of the ",(0,l.mdx)("inlineCode",{parentName:"p"},"PresentationDelegate"),", obtain a reference to the ",(0,l.mdx)("inlineCode",{parentName:"p"},"InAppMessageEventHandler")," for use in Javascript interactions."),(0,l.mdx)("h4",{id:"kotlin"},"Kotlin"),(0,l.mdx)("pre",null,(0,l.mdx)("code",{parentName:"pre",className:"language-kotlin"},"var eventHandler: InAppMessageEventHandler? = null\nvar currentMessagePresentable: Presentable<InAppMessage>? = null\n\noverride fun onShow(presentable: Presentable<*>) {\n  if (presentable.getPresentation() !is InAppMessage) {\n    return\n  }\n  currentMessagePresentable = presentable as Presentable<InAppMessage>\n  eventHandler = currentMessagePresentable?.getPresentation()?.eventHandler\n\n}\n")),(0,l.mdx)("h4",{id:"java"},"Java"),(0,l.mdx)("pre",null,(0,l.mdx)("code",{parentName:"pre",className:"language-java"},"InAppMessageEventHandler eventHandler = null;\nPresentable<InAppMessage> currentMessagePresentable = null;\n\n@Override\npublic void onShow(Presentable<?> presentable) {\n    if (!(presentable.getPresentation() instanceof InAppMessage)) {\n      return;\n    }\n    currentMessagePresentable = (Presentable<InAppMessage>) presentable;\n    eventHandler = currentMessagePresentable.getPresentation().getEventHandler();\n}\n")),(0,l.mdx)(p,{platform:"android2x",task:"obtain",repeat:"3",mdxType:"Variant"}),(0,l.mdx)("p",null,"On Android, the web view is represented as ",(0,l.mdx)("inlineCode",{parentName:"p"},"WebView"),".  "),(0,l.mdx)("h4",{id:"java-1"},"Java"),(0,l.mdx)("pre",null,(0,l.mdx)("code",{parentName:"pre",className:"language-java"},"@Override\npublic boolean shouldShowMessage(FullscreenMessage fullscreenMessage) {\n  // access to the whole message from the parent\n  Message message = (Message) fullscreenMessage.getParent();\n      \n  WebView webView = message.getWebView();\n  \n  ...\n}\n")),(0,l.mdx)(p,{platform:"ios",task:"obtain",repeat:"3",mdxType:"Variant"}),(0,l.mdx)("p",null,"On iOS, the web view is represented as ",(0,l.mdx)("inlineCode",{parentName:"p"},"WKWebView"),".  "),(0,l.mdx)("h4",{id:"swift"},"Swift"),(0,l.mdx)("pre",null,(0,l.mdx)("code",{parentName:"pre",className:"language-swift"},"func shouldShowMessage(message: Showable) -> Bool {\n    // access to the whole message from the parent\n    let fullscreenMessage = message as? FullscreenMessage\n    let message = fullscreenMessage?.parent\n\n    let messageWebView = message?.view as? WKWebView\n\n    ...\n}\n")),(0,l.mdx)(p,{platform:"android3x",task:"call",repeat:"6",mdxType:"Variant"}),(0,l.mdx)("p",null,"With a reference to the ",(0,l.mdx)("inlineCode",{parentName:"p"},"InAppMessageEventHandler"),", the instance method ",(0,l.mdx)("inlineCode",{parentName:"p"},"evaluateJavascript(String, AdobeCallback<String>)")," can now be leveraged to call a JavaScript method."),(0,l.mdx)("p",null,"Further details of this API are explained in the ",(0,l.mdx)("a",{parentName:"p",href:"https://developer.android.com/reference/android/webkit/WebView#evaluateJavascript(java.lang.String,%20android.webkit.ValueCallback%3Cjava.lang.String%3E)"},"Android")," documentation - the example below is provided for the purpose of demonstration:"),(0,l.mdx)("h4",{id:"kotlin-1"},"Kotlin"),(0,l.mdx)("pre",null,(0,l.mdx)("code",{parentName:"pre",className:"language-kotlin"},'var eventHandler: InAppMessageEventHandler? = null\nvar currentMessagePresentable: Presentable<InAppMessage>? = null\n\noverride fun onShow(presentable: Presentable<*>) {\n  if (presentable.getPresentation() !is InAppMessage) {\n    return\n  }\n  currentMessagePresentable = presentable as Presentable<InAppMessage>\n  eventHandler = currentMessagePresentable?.getPresentation()?.eventHandler\n  eventHandler?.evaluateJavascript("startTimer()") { content ->\n    // do something with the content\n  }\n}\n')),(0,l.mdx)("h4",{id:"java-2"},"Java"),(0,l.mdx)("pre",null,(0,l.mdx)("code",{parentName:"pre",className:"language-java"},'InAppMessageEventHandler eventHandler = null;\nPresentable<InAppMessage> currentMessagePresentable = null;\n\n@Override\npublic void onShow(Presentable<?> presentable) {\n  if (!(presentable.getPresentation() instanceof InAppMessage)) {\n    return;\n  }\n  currentMessagePresentable = (Presentable<InAppMessage>) presentable;\n  eventHandler = currentMessagePresentable.getPresentation().getEventHandler();\n  if (eventHandler != null) {\n    eventHandler.evaluateJavascript("startTimer()", s -> {\n    // do something with the content\n    });\n  }\n}\n')),(0,l.mdx)(p,{platform:"android2x",task:"call",repeat:"4",mdxType:"Variant"}),(0,l.mdx)("p",null,"With a reference to the ",(0,l.mdx)("inlineCode",{parentName:"p"},"WebView"),", the instance method ",(0,l.mdx)("inlineCode",{parentName:"p"},"public void evaluateJavascript(@NonNull String script, @Nullable ValueCallback<String> resultCallback)")," can now be leveraged to call a JavaScript method."),(0,l.mdx)("p",null,"Further details of this API are explained in the ",(0,l.mdx)("a",{parentName:"p",href:"https://developer.android.com/reference/android/webkit/WebView#evaluateJavascript(java.lang.String,%20android.webkit.ValueCallback%3Cjava.lang.String%3E)"},"Android documentation")," - the example below is provided for the purpose of demonstration:"),(0,l.mdx)("h4",{id:"java-3"},"Java"),(0,l.mdx)("pre",null,(0,l.mdx)("code",{parentName:"pre",className:"language-java"},'@Override\npublic boolean shouldShowMessage(FullscreenMessage fullscreenMessage) {\n  // access to the whole message from the parent\n  Message message = (Message) fullscreenMessage.getParent();\n      \n  WebView webView = message.getWebView();\n  // webview operations must be run on the ui thread\n  webView.post(new Runnable() {\n    @Override\n    public void run() {\n      webView.evaluateJavascript("startTimer()", new ValueCallback<String>() {\n        @Override\n        public void onReceiveValue(String s) {\n          // do something with the content\n        }\n      });\n    }\n  });\n  \n  ...\n}\n')),(0,l.mdx)(p,{platform:"ios",task:"call",repeat:"4",mdxType:"Variant"}),(0,l.mdx)("p",null,"With a reference to the ",(0,l.mdx)("inlineCode",{parentName:"p"},"WKWebView"),", the instance method ",(0,l.mdx)("inlineCode",{parentName:"p"},"evaluateJavaScript(_:completionHandler:)")," can now be leveraged to call a JavaScript method."),(0,l.mdx)("p",null,"Further details of this API are explained in the ",(0,l.mdx)("a",{parentName:"p",href:"https://developer.apple.com/documentation/webkit/wkwebview/1415017-evaluateJavaScript"},"Apple documentation")," - the example below is provided for the purpose of demonstration:"),(0,l.mdx)("h4",{id:"swift-1"},"Swift"),(0,l.mdx)("pre",null,(0,l.mdx)("code",{parentName:"pre",className:"language-swift"},'func shouldShowMessage(message: Showable) -> Bool {\n    // access to the whole message from the parent\n    let fullscreenMessage = message as? FullscreenMessage\n    let message = fullscreenMessage?.parent\n\n    // the `shouldShowMessage` delegate method is called on a background thread.\n    // need to dispatch code that uses the webview back to the main thread.\n    DispatchQueue.main.async {\n        let messageWebView = message?.view as? WKWebView\n\n        messageWebView?.evaluateJavaScript("startTimer();") { result, error in\n            if error != nil {\n                // handle error\n                return\n            }\n\n            if result != nil {\n                // do something with the result\n            }\n        }                \n    }\n\n    ...\n}\n')))}g.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-edge-adobe-journey-optimizer-in-app-message-tutorials-javascript-from-native-md-278f2f3b8899c445e299.js.map